<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Forum.TopicsUpdater">
<Description>
Initial topic updater</Description>
<Super>Forum.TopicsPage</Super>
<TimeCreated>63785,86397.415399</TimeCreated>

<Method name="Update">
<ClassMethod>1</ClassMethod>
<FormalSpec>forum="cache"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	Q ..Scan( forum )
]]></Implementation>
</Method>

<Method name="OnTopic">
<Description><![CDATA[
Event handler 
<var>data</var> - key-value array with topic properties 
If handler return 0, parsing will be interrupted]]></Description>
<FormalSpec><![CDATA[&data]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s extId = $g(data("ExtId"))
	
	s exist = ##class(Topic).ExtIdExists( extId, .topic )
	if 'exist Q ##class(Topic).Insert( data ) Q sc 	
	
	
	s updated = ##class(Topic).UpdatedGetStored( topic )
	if updated = $g(data("Updated")) Q 1 
	
	#; Insert your update logic here	
	
	Q 1
]]></Implementation>
</Method>

<Method name="Scan">
<Description>
Example scan across all forum topic pages</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>forum="cache"</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	s i = 0, count = 1, sc = 1
	for {
		
		s i = i + 1  if i > count Quit
		s page = ..GetPage( forum, i, .sc ) Q:'sc
		s:i=1 count = page.Pages() ; get pages count once
		s sc = page.Parse() Q:'sc
		w !, "Page #"_i_" successfuly updated", !
		
	}
	Q sc
]]></Implementation>
</Method>
</Class>
</Export>
